---
title: 数据库索引
date: 2020-11-23 18:01:55
tags: [数据库, B+树]
categories:
  - web
  - 数据库
---

参考博客：

- [数据库索引原理](https://blog.csdn.net/lnazj/article/details/90762470)
- [五种索引类型](https://blog.csdn.net/gaotiedun1/article/details/88584362)
- [什么是数据库索引，是怎么工作的](https://blog.csdn.net/calledWWW/article/details/79371040) (好文推荐)

前面有看不懂的地方可以跳过先看原理。

## 索引是什么

索引是一种数据结构。为了加速对表中数据行的检索而创建的。

## 作用(优点)

使用索引的全部意义就是通过减少一张表中需要查询的记录/行的数目来加快搜索的速度

- 大大加快数据的检索速度;
- 创建唯一性索引，保证数据库表中每一行数据的唯一性;
- 加速表和表之间的连接; (查询列中的某个值变快了，B+树索引:n->logn)
- 在使用分组和排序子句进行数据检索时，可以显著减少查询中分组和排序的时间。 (查询列中的某个值变快了，B+树索引:n->logn, 分组时根据某个值相同进行分组， 一般来说使用 B+树索引，其值是排好序的，所以使用排序子句更快)

## 缺点

- 索引需要占用数据表以外的物理存储空间。(索引本质是数据结构，常用的如 MySQL 中的 B+树)
- 降低了数据的维护速度，创建索引和维护索引要花费一定的时间。(创建树，向树中插入值或修改值)
- 当对表的数据进行 **INSERT,UPDATE,DELETE** 的时候,索引也要动态的维护,这样就会**降低数据的维护速度**,(**建立索引会占用磁盘空间的索引文件**。一般情况这个问题不太严重，但如果你在一个大表上创建了多种组合索引，索引文件的会膨胀很快)。

## 原理

索引是一种数据结构，存储的是表中某一列的值。有 B+树索引、哈希（散列）索引、bitmap(位图)索引、R-tree 等数据结构

### B+树

mysql 中 innodb 索引(MySQL 的默认存储引擎)，采用的就是是[B+树数据结构](https://blog.csdn.net/lnazj/article/details/90762470)。

- 这是一个多路平衡树，相比较平衡二叉树，它利用**多个分支的结点**，减少获取记录时所经历的结点数，从而达到节省存取时间的目的。
- (硬盘中的结点也是 B-tree 结构的。与内存相比，硬盘必须花成倍的时间来存取一个数据元素，这是因为硬盘的机械部件读写数据的速度远远赶不上纯电子媒体的内存。)
- 查询、插入、修改时间为 logn, n 为节点个数

### 哈希表索引

将列的值通过 hash 算法计算出 hash 值，将其作为索引的键值（key），和键值相对应实际的值（value）是指向该表中相应行的指针。即（hash 值，指针）, 类似于 map。
**哈希索引缺点:** 哈希表是无序的数据结构,只适合查询键值对, 也就是说查询相等的查询

### 其他索引

- R-Tree 作为索引, 通常用来为空间问题提供帮助。例如，一个查询要求“查询出所有距离我两公里之内的星巴克”，如果数据库表使用 R- Tree 索引，这类查询的效率将会提高。
- 位图索引（bitmap index）， 这类索引适合放在包含布尔值(true 和 false)的列上，但是这些值（表示 true 或 false 的值）的许多实例-基本上都是选择性（selectivity）低的列。

## 适用场景

- 表中某列在查询过程中使用的非常频繁，那就在该列上创建索引。

## 不适用场景

- 查询中很少使用到的列 不应该创建索引
- **很少数据的列也不应该建立索引?**
- 定义为 text 和 image 和 bit 数据类型的列不应该增加索引?
- 当表的修改(UPDATE,INSERT,DELETE)操作**远远大于**检索(SELECT)操作时不应该创建索引,这两个操作是互斥的关系

## 索引的原则(看不太懂)

[数据库索引原理](https://blog.csdn.net/lnazj/article/details/90762470)

- 5.1 离散性越高越好
- 5.2 最左匹配原则对索引中关键字进行计算（对比），一定是从左往右依次进行，且不可跳过
- 5.3 索引列的数据长度能少则少
- 5.4 匹配列前缀可用到索引 like %9999%、like %9999 用不到索引；
- 5.5 Where 条件中 not in 和 <>操作无法使用索引
- 5.6 多用指定列查询，只返回自己想到的数据列，少用 select \* ,这样有可能用到覆盖索引；
- 5.7 索引上不加计算

## 数据库怎么知道什么时候使用索引

当这个 SQL （SELECT \* FROM Employee WHERE Employee_Name = ‘Jesus’ ）运行时，数据库会检查在查询的列上是否有索引。假设 Employee_Name 列上确实创建了索引，数据库会接着检**查使用这个索引做查询是否合理** - 因为有些场景下，使用索引比起全表扫描会更加低效。

## 五种索引类型(待补充)

单列索引(主键索引,唯索引,普通索引)和组合索引

### 单列索引

### 组合索引?

,**原理?**(nickname_account_createdTime_Index) 那么他实际包含的是 3 个索引 (nickname) (nickname,account)(nickname,account,created_time)

在使用查询的时候遵循 mysql 组合索引的 **"最左前缀"?**

### 全文索引

**文本字段**上(text)如果建立的是普通索引,那么只有对文本的字段内容前面的字符进行索引,其字符大小根据索引建立索引时申明的大小来规定.如果文本中出现多个一样的字符,而且需要查找的话,那么其条件只能是 where column lick '%xxxx%' 这样做会让索引失效.这个时候全文索引就祈祷了作用了
